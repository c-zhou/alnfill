# ALNfill: Enhancing Genome Alignment by Filling Gaps with LastZ [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.14641762.svg)](https://doi.org/10.5281/zenodo.14641762)

Genome comparison is a critical and foundational task in many biological applications. While [LastZ](https://github.com/lastz/lastz) is renowned for generating highly sensitive alignments, its performance often comes at the expense of speed. In contrast, modern tools like [FastGA](https://github.com/thegenemyers/FASTGA), [minimap2](https://github.com/lh3/minimap2), and [wfmash](https://github.com/waveygang/wfmash) offer much faster genome alignment capabilities but typically sacrifice sensitivity, especially when applied to comparisons between highly divergent species.

ALNfill bridges this gap by combining the strengths of two approaches. It leverages the speed of modern aligners (primarily FastGA) and the sensitivity of LastZ to produce genome alignments that approach the sensitivity of LastZ while being more computationally efficient. The process begins with FastGA, which identifies alignments with sequence identities above 65%. ALNfill then detects alignment gaps where lower-identity sequences may still align, subsequently filling these gaps using LastZ.

This hybrid approach allows ALNfill to provide cost-effective genome alignments with high sensitivity, making it an excellent choice when speed is a critical factor.

## Installation

To compile ALNfile from source code, you need to have a C compiler, GNU make and zlib development files installed. Download the source code from this repo or with `git clone https://github.com/c-zhou/alnfill`. Then type `make` in the source code directory to compile.

## Dependencies

- You need the [LastZ](https://github.com/lastz/lastz) executable to run `alnfill`. It could be made available to the program through the environmental path or specified as a program parameter.

## Quick start

Below is a recipe for running FastGA followed by gap filling to align `qry.fa` to the reference genome `ref.fa`. This assumes that `lastz` is accessible in the environment; otherwise, the path must be specified for `alnfill` using the `-z` option.

```
FastGA -T8 -P. qry.fa ref.fa >fga.paf                 # run FastGA to generate a PAF file
alngap -t8 fga.paf >intervals.txt                     # generate a list of gaps for filling
alnfill -t8 ref.fa qry.fa intervals.txt >laz.paf      # run LastZ for gap filling
cat fga.paf laz.paf >all.paf                          # merge FastGA and LastZ results together
```

## Run ALNfill

ALNfill can be run in two simple steps.

### 1. Find alignment gaps with `alngap`

The `alngap` program takes a PAF file as input and outputs a list of candidate gap-filling intervals, consisting of six columns.

Here is an example to run `alngap`,
  
    alngap input.paf >intervals.txt

Below is the detailed help message for additional optional parameters.

```
Usage: alngap [options] input.paf[.gz]
Options:
  -l INT               min gap size to fill in [100]
  -m INT               max gap size to fill in [1M]
  -e INT               max flank sequence size [1K]
  -a                   use all instead of reciprocal best alignments
  -f INT               max overlap for reciprocal best alignments [0.5]
  -t INT               number of threads [1]
  -o FILE              write output to a file [stdout]
  -v INT               verbose level [0]
  --version            show version number

Example: ./alngap -o intervals.txt input.paf
```

### 2. Fill alignment gaps with `alnfill`

The `alnfill` program takes three positions parameters as inputs: the reference genome, the query genome, and the interval list generated by `alngap`. The output is a PAF format file. It should be noted that the output PAF file only contains alignments in the gap regions. To obtain the complete set of alignments, the PAF file in this step should be merged with the original PAF file used in the `alngap` step.

Here is an example to run `alngap`,
  
    alnfill -t64 ref.fa.gz qry.fa.gz intervals.txt >gapfill.paf

Below is the detailed help message for additional optional parameters.

```
Usage: alnfill [options] ref.fa[.gz] qry.fa[.gz] intervals
Options:
  -t INT               number of threads [1]
  -w STR               work directory for temporary files [./]
  -z STR               lastz executable path [lastz]
  -o FILE              write output to a file [stdout]
  -v INT               verbose level [0]
  --version            show version number

Example: ./alnfill -t 32 -o gapfill.paf ref.fa qry.fa intervals.txt
```

## Known issues

There are likely overlaps between the FastGA alignments and LastZ alignments due to the `-e` parameter in `alngap`. However, setting this parameter to `0` is not an ideal solution as it could result in some missed alignments that extend from the FastGA alignments.
